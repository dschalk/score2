<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Score2 by dschalk</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Score2</h1>
        <h2>Haskell websockets up and running.</h2>

        <section id="downloads">
          <a href="https://github.com/dschalk/score2/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/dschalk/score2/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/dschalk/score2" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h2>
<a id="the-game-of-score" class="anchor" href="#the-game-of-score" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Game of Score</h2>

<h4>
<a id="an-extension-of-githubcomjaspervdjwebsockets-as-implemented-by-yesodwebwaiwai-websockets" class="anchor" href="#an-extension-of-githubcomjaspervdjwebsockets-as-implemented-by-yesodwebwaiwai-websockets" aria-hidden="true"><span class="octicon octicon-link"></span></a><em>An extension of github.com/jaspervdj/websockets as implemented by yesodweb/wai/wai-websockets</em>
</h4>

<h4>
<a id="rules-of-score" class="anchor" href="#rules-of-score" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rules of "Score"</h4>

<p>Four dice are rolled. The default die are two six-sided, one twelve-sided, and one twenty-sided die. The goal is to make the number "20" in two or three steps using addition, subtraction, multiplication, division, and/or concatenation.</p>

<p>If a player calls out "Score!", or clicks "SCORE" in the computer version, he or she must quickly demonstrate how to make the number "20". Failure to do so loses the player one point; success gains a point. Clicking "SCORE" starts a countdown which currently allows 30 seconds, which is more than enough time if you already know a solution.</p>

<p>If a player clicks "IMPOSSIBLE", a 60-second countdown begins. If no player clicks "SCORE" during the 60 seconds, the player who clicked "IMPOSSIBLE" gains one point. If a player clicks "SCORE" during the countdown and succeeds in making "20" within 30 seconds, the player who clicked "IMPOSSIBLE" loses two points. It is possible for the player who clicked "IMPOSSIBLE" to also click "SCORE". Making the number "20" within 30 seconds gains back one of the two points lost because the 60 second countdown was successfully interrupted.</p>

<p>In order to gain a point by making the number "20", a player must use a number generated by a previous computation. Numbers generated during game play are colored red.</p>

<p>Players start out in solitaire mode. Clicking "Group A" or "Group B" puts a player in competition with any other players who made the same choice. Clicking "Player Created" allows a player to start a new group, or to join one that another player created. Players can communicate by exchanging text messages in the chat box. Players can return to solitaire play by clicking "Go Private".</p>

<p>Students and anyone who wants to brush up on arithmetic are encouraged to look for mistakes in the computer generated lists of solutions. Does 15-(-5)=20 look right?. What about 2+(3<em>(4/(2/3)))=20? They are both correct. 4/(2/3) = 4</em>3/2 = 12/2 = 6; 3*6 = 18; and 18+2 = 20. You have to solve the innermost equations first, methodically working your way out.</p>

<h3>
<a id="how-the-game-was-developed" class="anchor" href="#how-the-game-was-developed" aria-hidden="true"><span class="octicon octicon-link"></span></a>How The Game Was Developed</h3>

<p>by David Schalk</p>

<p>I started with the chat example at github.com/wai/wai-websockets. It is Jasper Van der Jeugt 's websockets adapted to the warp web server. The routine work of the chat server is receiving messages from individual browsers and broadcasting them to all participants. The server also parses sign-in messages to make sure the format is correct and there are no duplicate player names. The server keeps a list of participants in a Haskelll programming language container called an 'MVar', and replaces the list with a new, up-to-date list whenever there is a disconnect, score change, group membership change, or a new sign-in.</p>

<p>I modified the wai-websockets chat application's participant list to include scores and group affiliations in addition to names. Whenever the list is replaced, the server broadcasts a line of text interspersed with 'br' in brackets and the prefix 'CB#$42'. The browsers intercept these messages and divert them away from the chat message section and into the scoreboard. </p>

<p>Message prefixes are in the format 'Cx#42' where 'x' is some capital letter. None of these go into the chat message section. They contain data and instructions controlling the flow of the game. Application messages are either Javascript strings or Haskell Text. Browsers split comma-separated strings arriving at the browser into an array named "gameArray", and distribute the elements according to their prefixes. The prefix is the first item in gameArray; i.e., gameArray[0]. gameArray[1] is the name of the sender's group, and gameArray[2] is the sender's name. The other array items vary according to the purpose of the message. Scoreboard messages, which are prefixed by 'CB#$42', contain items separated by HTML line break code rather tham commas. Everything after the prefix is formatted HTML, ready for insertion in the scrore board display, so there is no need for the gameArray list corresponding to prefix 'CB#$42'.</p>

<h4>
<a id="initiation-stage" class="anchor" href="#initiation-stage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Initiation Stage</h4>

<p>The game interface in the browsers responds to invisible text messages transmitted by the server. Javascript interprets these as strings, and the strings it sends become text before they are used in the server application. Chat messages sent to the server are broadcast to all participating browsers. Game constrol messages cause the server to broadcast messages, but not necessarily the messages that were received. For example, messages prefixed by 'CA#$42' prompt the server to broadcast a random dice roll. These are screened by the browser to make sure they are displayed browsers of players belonging to the group of the sender, and ignored by the others.</p>

<p>A player joins the game by entering a name in a form. Here is the Javascript form code:</p>

<div class="highlight highlight-Javascript"><pre>$(<span class="pl-s1"><span class="pl-pds">'</span>#join-form<span class="pl-pds">'</span></span>).<span class="pl-s3">submit</span>(<span class="pl-st">function</span> () {
    $(<span class="pl-s1"><span class="pl-pds">'</span>#warnings<span class="pl-pds">'</span></span>).html(<span class="pl-s1"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>);
    <span class="pl-s">var</span> user <span class="pl-k">=</span> $(<span class="pl-s1"><span class="pl-pds">'</span>#user<span class="pl-pds">'</span></span>).val();
    playerM <span class="pl-k">=</span> newplayer(user);
    ws <span class="pl-k">=</span> createWebSocket(<span class="pl-s1"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span>);
    <span class="pl-s3">ws</span>.<span class="pl-en">onopen</span> <span class="pl-k">=</span> <span class="pl-st">function</span>() {
        ws.<span class="pl-s3">send</span>(<span class="pl-s1"><span class="pl-pds">"</span>CC#$42<span class="pl-pds">"</span></span> <span class="pl-k">+</span> user);
    };
}</pre></div>

<p>The server parses the message prefixed by CC#\$42 and, if the name is in the proper format and hasn't already been taken, the server (1) replaces ServerState list of Clients contained in the state MVar with with a ServerState list which includes the new player, (2) broadcasts an announcement for placement in the chat section of participating browsers, [3] broadcasts the updated state information for placement in the scoreboard section: and (4) sends the message "CC#$42" intended only for the new player.</p>

<p>This is the server code:</p>

<div class="highlight highlight-haskell"><pre>liftIO $ modifyMVar_ state $ \s -&gt; <span class="pl-k">do</span>
    <span class="pl-k">let</span> s' = addClient client s  
    <span class="pl-c1">WS</span>.sendTextData conn $ <span class="pl-c1">T</span>.pack <span class="pl-s1"><span class="pl-pds">"</span>CC#$42<span class="pl-pds">"</span></span>
    broadcast (getName client <span class="pl-k">`mappend`</span> <span class="pl-s1"><span class="pl-pds">"</span> joined<span class="pl-pds">"</span></span>) s'
    broadcast (<span class="pl-s1"><span class="pl-pds">"</span>CB#$42<span class="pl-pds">"</span></span> <span class="pl-k">`mappend`</span> <span class="pl-c1">T</span>.<span class="pl-s3">concat</span>(intersperse (<span class="pl-c1">T</span>.pack <span class="pl-s1"><span class="pl-pds">"</span>&lt;br&gt;<span class="pl-pds">"</span></span>) (<span class="pl-s3">map</span> tr s'))) s'
    <span class="pl-s3">return</span> s'</pre></div>

<p>The message prefixed by "CB#$42" is processed in the browsers as follows:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">case</span> <span class="pl-s1"><span class="pl-pds">"</span>CB#$42<span class="pl-pds">"</span></span><span class="pl-k">:</span>
  $(<span class="pl-s1"><span class="pl-pds">"</span>#users<span class="pl-pds">"</span></span>).html(<span class="pl-s3">event</span>.<span class="pl-sc">data</span>.<span class="pl-s3">substring</span>(<span class="pl-c1">6</span>));
<span class="pl-k">break</span>;</pre></div>

<p>The message 'CC#$42', received from the server, is processed in the 'ws.onmessage' section under the sign-in form.</p>

<div class="highlight highlight-javascript"><pre>    $(<span class="pl-s1"><span class="pl-pds">'</span>#join-form<span class="pl-pds">'</span></span>).<span class="pl-s3">submit</span>(<span class="pl-st">function</span> () {
        $(<span class="pl-s1"><span class="pl-pds">'</span>#warnings<span class="pl-pds">'</span></span>).html(<span class="pl-s1"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>);
        <span class="pl-s">var</span> user <span class="pl-k">=</span> $(<span class="pl-s1"><span class="pl-pds">'</span>#user<span class="pl-pds">'</span></span>).val();
        DS_ob.player <span class="pl-k">=</span> user;
        ws <span class="pl-k">=</span> createWebSocket(<span class="pl-s1"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span>);
        <span class="pl-s3">ws</span>.<span class="pl-en">onopen</span> <span class="pl-k">=</span> <span class="pl-st">function</span>() {
            ws.<span class="pl-s3">send</span>(<span class="pl-s1"><span class="pl-pds">"</span>CC#$42<span class="pl-pds">"</span></span> <span class="pl-k">+</span> user);
        };
        <span class="pl-s3">ws</span>.<span class="pl-en">onmessage</span> <span class="pl-k">=</span> <span class="pl-st">function</span>(<span class="pl-vpf">event</span>) {
            <span class="pl-k">if</span>(<span class="pl-s3">event</span>.<span class="pl-sc">data</span> <span class="pl-k">===</span> <span class="pl-s1"><span class="pl-pds">"</span>CC#$42<span class="pl-pds">"</span></span>) {
                DS_ob.d <span class="pl-k">=</span> <span class="pl-k">-</span><span class="pl-c1">1</span>;
                createDom();
                createOperators();
                createDropboxes();
                $(<span class="pl-s1"><span class="pl-pds">'</span>.drag<span class="pl-pds">'</span></span>).draggable({ revert<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>invalid<span class="pl-pds">"</span></span>, zIndex<span class="pl-k">:</span> <span class="pl-c1">2</span> });
                $(<span class="pl-s1"><span class="pl-pds">'</span>.dragNew<span class="pl-pds">'</span></span>).draggable({ revert<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>invalid<span class="pl-pds">"</span></span>, zIndex<span class="pl-k">:</span> <span class="pl-c1">2</span> });
                $(<span class="pl-s1"><span class="pl-pds">'</span>.drag2<span class="pl-pds">'</span></span>).draggable({ helper<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>clone<span class="pl-pds">"</span></span>, revert<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>invalid<span class="pl-pds">"</span></span>, zIndex<span class="pl-k">:</span> <span class="pl-c1">2</span> });
                createDrop1();
                createDrop2();
                $(<span class="pl-s1"><span class="pl-pds">"</span>#result1<span class="pl-pds">"</span></span>).hide();
                $(<span class="pl-s1"><span class="pl-pds">"</span>#result2<span class="pl-pds">"</span></span>).hide();
                $(<span class="pl-s1"><span class="pl-pds">"</span>#result3<span class="pl-pds">"</span></span>).hide();
                $(<span class="pl-s1"><span class="pl-pds">"</span>#b0<span class="pl-pds">"</span></span>).show();
                $(<span class="pl-s1"><span class="pl-pds">"</span>#experiment<span class="pl-pds">"</span></span>).show();
                $(<span class="pl-s1"><span class="pl-pds">"</span>#public<span class="pl-pds">"</span></span>).show();
                $(<span class="pl-s1"><span class="pl-pds">"</span>#b0<span class="pl-pds">"</span></span>).html(<span class="pl-s1"><span class="pl-pds">"</span>Solitaire mode. Click above to enable competition.<span class="pl-pds">"</span></span>)
                $(<span class="pl-s1"><span class="pl-pds">"</span>#rollA<span class="pl-pds">"</span></span>).show();
                $(<span class="pl-s1"><span class="pl-pds">"</span>#a1<span class="pl-pds">"</span></span>).show();
                $(<span class="pl-s1"><span class="pl-pds">'</span>#join-section<span class="pl-pds">'</span></span>).hide();
                $(<span class="pl-s1"><span class="pl-pds">'</span>#chat-section<span class="pl-pds">'</span></span>).show();
                $(<span class="pl-s1"><span class="pl-pds">'</span>#users-section<span class="pl-pds">'</span></span>).show();
                $(<span class="pl-s1"><span class="pl-pds">"</span>#messages<span class="pl-pds">"</span></span>).show();
                $(<span class="pl-s1"><span class="pl-pds">"</span>.dropx<span class="pl-pds">"</span></span>).hide();
                $(<span class="pl-s1"><span class="pl-pds">"</span>.drop2x<span class="pl-pds">"</span></span>).hide();
                ws.onmessage <span class="pl-k">=</span> onMessage;
                $(<span class="pl-s1"><span class="pl-pds">'</span>#message-form<span class="pl-pds">'</span></span>).<span class="pl-s3">submit</span>(<span class="pl-st">function</span> () {
                    <span class="pl-s">var</span> text <span class="pl-k">=</span> $(<span class="pl-s1"><span class="pl-pds">'</span>#text<span class="pl-pds">'</span></span>).val();
                    ws.<span class="pl-s3">send</span>(text);
                    $(<span class="pl-s1"><span class="pl-pds">'</span>#text<span class="pl-pds">'</span></span>).val(<span class="pl-s1"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>);
                    <span class="pl-k">return</span> <span class="pl-c1">false</span>;
                });
            } <span class="pl-k">else</span> {
                <span class="pl-en">console</span><span class="pl-s3">.log</span>(<span class="pl-s1"><span class="pl-pds">"</span>What?<span class="pl-pds">"</span></span>);
                $(<span class="pl-s1"><span class="pl-pds">'</span>#warnings<span class="pl-pds">'</span></span>).append(<span class="pl-s3">event</span>.<span class="pl-sc">data</span>);
                ws.<span class="pl-s3">close</span>();
                <span class="pl-k">delete</span> $(<span class="pl-s1"><span class="pl-pds">'</span>#join-form<span class="pl-pds">'</span></span>);
            }
        };

        $(<span class="pl-s1"><span class="pl-pds">'</span>#join<span class="pl-pds">'</span></span>).append(<span class="pl-s1"><span class="pl-pds">'</span>Connecting...<span class="pl-pds">'</span></span>);

        <span class="pl-k">return</span> <span class="pl-c1">false</span>;
    });
    $(<span class="pl-s1"><span class="pl-pds">'</span>#join-form<span class="pl-pds">'</span></span>).destroy();
});</pre></div>

<p>After it initiates the player interface, 'ws.onmessage = onMessage' de-references the anonymous function and re-assignes the variable 'ws.onmessage' to onMessage. The entire 'join-form' section becomes eligible for garbage collection after the final line,' delete $('#join-form');'.</p>

<p>When current players receive "CC#$42" prefixed messages from new sign-ins, these messages do not make it to the chat message section. They hit a dead end in the 'onMessage' section.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">case</span> <span class="pl-s1"><span class="pl-pds">"</span>CC#$42<span class="pl-pds">"</span></span><span class="pl-k">:</span>
<span class="pl-c">// Prevents new player login message from defaulting to a chat message.</span>
<span class="pl-k">break</span>;</pre></div>

<h4>
<a id="state-and-its-mvar" class="anchor" href="#state-and-its-mvar" aria-hidden="true"><span class="octicon octicon-link"></span></a>State And Its MVar</h4>

<p>I have mentioned a ServerState list of clients and an MVar that holds the current state of the game. Here is how that game state is defined:</p>

<div class="highlight highlight-haskell"><pre><span class="pl-k">type</span> <span class="pl-c1">Name</span> = <span class="pl-c1">Text</span>
<span class="pl-k">type</span> <span class="pl-c1">Score</span> = <span class="pl-c1">Int</span>
<span class="pl-k">type</span> <span class="pl-c1">Group</span> = <span class="pl-c1">Text</span>
<span class="pl-k">type</span> <span class="pl-c1">Client</span> = (<span class="pl-c1">Name</span>, <span class="pl-c1">Score</span>, <span class="pl-c1">Group</span>, <span class="pl-c1">WS</span>.<span class="pl-c1">Connection</span>)
<span class="pl-k">type</span> <span class="pl-c1">ServerState</span> = [<span class="pl-c1">Client</span>]

<span class="pl-en">newServerState</span> <span class="pl-k">::</span> <span class="pl-st">ServerState</span>
newServerState = <span class="pl-c1">[]</span></pre></div>

<p>The game state is placed in an MVar as follows:</p>

<div class="highlight highlight-haskell"><pre>main = <span class="pl-k">do</span>
    state &lt;- newMVar newServerState</pre></div>

<p>State is modified during game play by replacing the ServerState list of Clients in the MVar. For example, the following code increases a player's score:</p>

<div class="highlight highlight-haskell"><pre><span class="pl-en">incFunc</span> <span class="pl-k">::</span> <span class="pl-st">Text</span> <span class="pl-k">-&gt;</span> <span class="pl-st">Client</span> <span class="pl-k">-&gt;</span> <span class="pl-st">Client</span>
incFunc x (a, b, c)   | x == a   = (a, b + <span class="pl-c1">1</span>, c)
                      | <span class="pl-s3">otherwise</span> = (a, b, c)

<span class="pl-en">upScore</span> <span class="pl-k">::</span> <span class="pl-st">Text</span> <span class="pl-k">-&gt;</span> <span class="pl-st">ServerState</span> <span class="pl-k">-&gt;</span> <span class="pl-st">ServerState</span>
upScore name = <span class="pl-s3">map</span> (incFunc name)

. . .

<span class="pl-k">else</span> <span class="pl-k">if</span> <span class="pl-s1"><span class="pl-pds">"</span>CG#$42<span class="pl-pds">"</span></span> `<span class="pl-c1">T</span>.isPrefixOf` msg
    <span class="pl-k">then</span>
    mask_ $ <span class="pl-k">do</span>  
        old &lt;- takeMVar state
        <span class="pl-k">let</span> new = upScore sender old
        putMVar state new
        broadcast msg new
        broadcast (<span class="pl-s1"><span class="pl-pds">"</span>CB#$42<span class="pl-pds">"</span></span> <span class="pl-k">`mappend`</span> <span class="pl-c1">T</span>.<span class="pl-s3">concat</span> (intersperse <span class="pl-s1"><span class="pl-pds">"</span>&lt;br&gt;<span class="pl-pds">"</span></span> (<span class="pl-s3">map</span> tr new))) new
</pre></div>

<p>The 'msg' being broadcast is just the unaltered message that was received, prefixed by 'CG#$42' and containing the sender's name, among other things. The 'CB#$42' prefixed message updates the browser scoreboards.</p>

<h4>
<a id="organization-of-game-data" class="anchor" href="#organization-of-game-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Organization of Game Data</h4>

<p>I believe the most efficient way to organize game data and avoid global name clashes is to put the game data in a simple Javascript object. I don't think anything would be gained by using getter and setter functions. Values can be set by code such as 'object.name = some_value', and can be obtained by 'some_variable = object.name'.</p>

<p>But this project is mainly for fun, and I had fun playing with various ways of organizing the data. At the time of this writing, some data is in an object named DS_ob, and most of it is in Javascript monads. I patterned the monads after Douglas Crockford's example at <a href="https://github.com/douglascrockford/monad">https://github.com/douglascrockford/monad</a>. I removed the parts I didn't need, and used only functions in the form 'a -&gt; Monad b' in the monad bind function. This conforms with the Haskell definition of a monad.</p>

<p>I don't see any practical advantage in using monads. Value are extracted from monads willy-nilly, making their use akin to using unsafePerformIO and unsafeCoerce in Haskell. I do see a resemblance to the MVar code used in the server.</p>

<p>The state MVar gets defined once and only its contents change as the game goes on. The same is true for the elements of DS_ob and for monads. Just for fun, I avoided mutating variables in the monad code. Old lists of game data are removed and discarded, to be replaced by newly created ones.</p>

<p>Here is the code:</p>

<div class="highlight highlight-javascript"><pre>
<span class="pl-st">function</span> <span class="pl-en">MONAD</span>() {
    <span class="pl-s1"><span class="pl-pds">'</span>use strict<span class="pl-pds">'</span></span>;
    <span class="pl-s">var</span> prototype <span class="pl-k">=</span> <span class="pl-s3">Object</span>.create(<span class="pl-c1">null</span>);
    prototype.is_monad <span class="pl-k">=</span> <span class="pl-c1">true</span>;
    <span class="pl-st">function</span> <span class="pl-en">unit</span>(<span class="pl-vpf">value</span>) {
        <span class="pl-s">var</span> monad <span class="pl-k">=</span> <span class="pl-s3">Object</span>.create(prototype);
        monad.val <span class="pl-k">=</span> value;
        <span class="pl-s3">monad</span>.<span class="pl-en">bind</span> <span class="pl-k">=</span> <span class="pl-st">function</span> (<span class="pl-vpf">func</span>, <span class="pl-vpf">args</span>) {
            <span class="pl-k">return</span> func.<span class="pl-s3">apply</span>(
                <span class="pl-c1">undefined</span>,
                [value].<span class="pl-s3">concat</span>(<span class="pl-s3">Array</span>.<span class="pl-sc">prototype</span>.slice.<span class="pl-s3">apply</span>(args <span class="pl-k">||</span> []))
            );
        };
        <span class="pl-k">return</span> monad;
    }
    <span class="pl-k">return</span> unit;
}

<span class="pl-s">var</span> newData <span class="pl-k">=</span> <span class="pl-st">function</span> <span class="pl-en">newData</span>(<span class="pl-vpf">x</span>,<span class="pl-vpf">y</span>,<span class="pl-vpf">z</span>) {
  newVal <span class="pl-k">=</span> x;
  newVal[z] <span class="pl-k">=</span> y; 
  <span class="pl-v">this</span>.val <span class="pl-k">=</span> identity(newVal);
  <span class="pl-k">return</span> <span class="pl-v">this</span>;
}

<span class="pl-s">var</span> identity <span class="pl-k">=</span> MONAD();
<span class="pl-s">var</span> monad <span class="pl-k">=</span> identity([<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">0</span>]);

<span class="pl-st">function</span> <span class="pl-en">newplayer</span>(<span class="pl-vpf">name</span>) { 
    <span class="pl-k">return</span> monad.bind(newData, [name, <span class="pl-c1">0</span>]).val;
}
playerM <span class="pl-k">=</span> newplayer(<span class="pl-s1"><span class="pl-pds">"</span>Jack of Hearts<span class="pl-pds">"</span></span>);

<span class="pl-st">function</span> <span class="pl-en">newimpossibleClicker</span>(<span class="pl-vpf">name</span>) { 
    <span class="pl-k">return</span> monad.bind(newData, [name, <span class="pl-c1">1</span>]).val;
}
impossibleClickerM <span class="pl-k">=</span> newimpossibleClicker(<span class="pl-s1"><span class="pl-pds">"</span>King of Diamonds<span class="pl-pds">"</span></span>);

<span class="pl-st">function</span> <span class="pl-en">newscoreClicker</span>(<span class="pl-vpf">name</span>) { 
    <span class="pl-k">return</span> monad.bind(newData, [name, <span class="pl-c1">2</span>]).val;
}
scoreClickerM <span class="pl-k">=</span> newscoreClicker(<span class="pl-s1"><span class="pl-pds">"</span>Ace of Spades<span class="pl-pds">"</span></span>);
<span class="pl-c">// scoreClicker = scoreClickerM.val[2];</span>


<span class="pl-st">function</span> <span class="pl-en">newgroup</span>(<span class="pl-vpf">name</span>) { 
    <span class="pl-k">return</span> monad.bind(newData, [name, <span class="pl-c1">3</span>]).val;
}
groupM <span class="pl-k">=</span> newgroup(<span class="pl-s1"><span class="pl-pds">"</span>private<span class="pl-pds">"</span></span>);


<span class="pl-st">function</span> <span class="pl-en">newrollText</span>(<span class="pl-vpf">name</span>) { 
    <span class="pl-k">return</span> monad.bind(newData, [name, <span class="pl-c1">4</span>]).val;
}
rollTextM <span class="pl-k">=</span> newrollText(<span class="pl-s1"><span class="pl-pds">"</span>1,1,1,1,42<span class="pl-pds">"</span></span>);


<span class="pl-st">function</span> <span class="pl-en">newd</span>(<span class="pl-vpf">num</span>) { 
    <span class="pl-k">return</span> monad.bind(newData, [num, <span class="pl-c1">5</span>]).val;
}
dM <span class="pl-k">=</span> newd(<span class="pl-k">-</span><span class="pl-c1">1</span>);


<span class="pl-st">function</span> <span class="pl-en">newgame</span>(<span class="pl-vpf">toggle</span>) { 
    <span class="pl-k">return</span> monad.bind(newData, [toggle, <span class="pl-c1">6</span>]).val;
}
gameM <span class="pl-k">=</span> newgame(<span class="pl-s1"><span class="pl-pds">"</span>off<span class="pl-pds">"</span></span>);

<span class="pl-st">function</span> <span class="pl-en">MakeDS_ob</span>() {
    <span class="pl-v">this</span>.t <span class="pl-k">=</span> <span class="pl-k">-</span><span class="pl-c1">1</span>,
    <span class="pl-v">this</span>.ar <span class="pl-k">=</span> [];
    <span class="pl-v">this</span>.bool <span class="pl-k">=</span> [];
    <span class="pl-s3">this</span>.<span class="pl-en">scoreFunc</span> <span class="pl-k">=</span> <span class="pl-st">function</span>() {
        $(<span class="pl-s1"><span class="pl-pds">"</span>#countdown<span class="pl-pds">"</span></span>).html(<span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>);
        $(<span class="pl-s1"><span class="pl-pds">"</span>#a0<span class="pl-pds">"</span></span>).html(<span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>);
        <span class="pl-k">if</span> (playerM.val[<span class="pl-c1">0</span>] <span class="pl-k">===</span> scoreClickerM.val[<span class="pl-c1">2</span>]) {
            ws.<span class="pl-s3">send</span>(<span class="pl-s1"><span class="pl-pds">"</span>CL#$42,<span class="pl-pds">"</span></span> <span class="pl-k">+</span> groupM.val[<span class="pl-c1">3</span>] <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>,<span class="pl-pds">"</span></span> <span class="pl-k">+</span> playerM.val[<span class="pl-c1">0</span>] <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>,<span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>dummy<span class="pl-pds">"</span></span>);
        }
        <span class="pl-k">if</span> ( playerM.val[<span class="pl-c1">0</span>] <span class="pl-k">===</span> impossibleClickerM.val[<span class="pl-c1">1</span>]) {
            ws.<span class="pl-s3">send</span>(<span class="pl-s1"><span class="pl-pds">"</span>CM#$42,<span class="pl-pds">"</span></span><span class="pl-k">+</span> groupM.val[<span class="pl-c1">3</span>] <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>,<span class="pl-pds">"</span></span> <span class="pl-k">+</span> playerM.val[<span class="pl-c1">0</span>] <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>,<span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>dummy<span class="pl-pds">"</span></span>);
        }
    }
}
<span class="pl-s">var</span> DS_ob <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">MakeDS_ob</span>();
</pre></div>

<p>The use of new in the last line sets the context of DS_ob in concrete, but that isn't necessary. It would have sufficed to just define DS_ob as a simple object rather than the result of invoking a constructor. Wrapping the game variables in a closure wouldn't serve any useful purpose. And the monads. Well, they were just my idea of fun. I set values and get values as follows:</p>

<div class="highlight highlight-Javascript"><pre><span class="pl-st">function</span> <span class="pl-en">newimpossibleClicker</span>(<span class="pl-vpf">name</span>) { 
    <span class="pl-k">return</span> monad.bind(newData, [name, <span class="pl-c1">1</span>]).val;
}
impossibleClickerM <span class="pl-k">=</span> newimpossibleClicker(<span class="pl-k">new</span> <span class="pl-en">name</span>);
some_variable <span class="pl-k">=</span> impossibleClickerM.val[<span class="pl-c1">1</span>];
</pre></div>

<p><strong>Screening Massages Arriving At The Browsers</strong></p>

<p>The first stage of processing messages coming into the browsers is as follows:</p>

<div class="highlight highlight-javascript"><pre>    <span class="pl-st">function</span> <span class="pl-en">onMessage</span>(<span class="pl-vpf">event</span>) {
        $(<span class="pl-s1"><span class="pl-pds">"</span>#go30<span class="pl-pds">"</span></span>).hide();
        $(<span class="pl-s1"><span class="pl-pds">"</span>#go60<span class="pl-pds">"</span></span>).hide();
        $(<span class="pl-s1"><span class="pl-pds">"</span>#stop30<span class="pl-pds">"</span></span>).hide();
        $(<span class="pl-s1"><span class="pl-pds">"</span>#stop60<span class="pl-pds">"</span></span>).show();
        <span class="pl-s">var</span> game <span class="pl-k">=</span> gameM.val[<span class="pl-c1">6</span>];
        <span class="pl-s">var</span> impX <span class="pl-k">=</span> impossibleClickerM.val[<span class="pl-c1">1</span>];
        <span class="pl-s">var</span> plX <span class="pl-k">=</span> playerM.val[<span class="pl-c1">0</span>];
        <span class="pl-s">var</span> scX <span class="pl-k">=</span> scoreClickerM.val[<span class="pl-c1">2</span>];
        <span class="pl-s">var</span> prX <span class="pl-k">=</span> groupM.val[<span class="pl-c1">3</span>];
        <span class="pl-s">var</span> gameArray <span class="pl-k">=</span> <span class="pl-s3">event</span>.<span class="pl-sc">data</span>.<span class="pl-s3">split</span>(<span class="pl-s1"><span class="pl-pds">"</span>,<span class="pl-pds">"</span></span>);
        <span class="pl-s">var</span> d2 <span class="pl-k">=</span> <span class="pl-s3">event</span>.<span class="pl-sc">data</span>.<span class="pl-s3">substring</span>(<span class="pl-c1">0</span>,<span class="pl-c1">6</span>);
        <span class="pl-s">var</span> d3 <span class="pl-k">=</span> <span class="pl-s3">event</span>.<span class="pl-sc">data</span>.<span class="pl-s3">substring</span>(<span class="pl-c1">2</span>,<span class="pl-c1">6</span>);
        <span class="pl-s">var</span> group <span class="pl-k">=</span> gameArray[<span class="pl-c1">1</span>];
        <span class="pl-s">var</span> sender <span class="pl-k">=</span> gameArray[<span class="pl-c1">2</span>];
        <span class="pl-s">var</span> extra <span class="pl-k">=</span> gameArray[<span class="pl-c1">3</span>];
        <span class="pl-s">var</span> ext4<span class="pl-k">=</span> gameArray[<span class="pl-c1">4</span>];
        <span class="pl-s">var</span> ext5 <span class="pl-k">=</span> gameArray[<span class="pl-c1">5</span>];
        <span class="pl-s">var</span> ext6 <span class="pl-k">=</span> gameArray[<span class="pl-c1">6</span>];
        <span class="pl-s">var</span> ext7 <span class="pl-k">=</span> gameArray[<span class="pl-c1">7</span>];
        <span class="pl-s">var</span> ext8 <span class="pl-k">=</span> gameArray[<span class="pl-c1">8</span>];
        <span class="pl-en">console</span><span class="pl-s3">.log</span>(gameArray);
        <span class="pl-s">var</span> p <span class="pl-k">=</span> $(<span class="pl-s3">document</span>.<span class="pl-s3">createElement</span>(<span class="pl-s1"><span class="pl-pds">'</span>p<span class="pl-pds">'</span></span>)).<span class="pl-sc">text</span>(<span class="pl-s3">event</span>.<span class="pl-sc">data</span>);
        <span class="pl-k">if</span> (prX <span class="pl-k">===</span> sourceStatus) {
            <span class="pl-k">switch</span> (d2) {
                <span class="pl-k">case</span> <span class="pl-s1"><span class="pl-pds">"</span>CA#$42<span class="pl-pds">"</span></span><span class="pl-k">:</span>
                . . .</pre></div>

<p>This is information already in the browser:</p>

<div class="highlight highlight-Javascript"><pre>        <span class="pl-s">var</span> game <span class="pl-k">=</span> gameM.val[<span class="pl-c1">6</span>];
        <span class="pl-s">var</span> impX <span class="pl-k">=</span> impossibleClickerM.val[<span class="pl-c1">1</span>];
        <span class="pl-s">var</span> plX <span class="pl-k">=</span> playerM.val[<span class="pl-c1">0</span>];
        <span class="pl-s">var</span> scX <span class="pl-k">=</span> scoreClickerM.val[<span class="pl-c1">2</span>];
        <span class="pl-s">var</span> prX <span class="pl-k">=</span> groupM.val[<span class="pl-c1">3</span>];</pre></div>

<p>The gameArray data is what the server sent.</p>

<p>Time control is facilitated by the Rx.js package. <a href="https://github.com/Reactive-Extensions/RxJS">https://github.com/Reactive-Extensions/RxJS</a>. The Microsoft corporation can join the human race and do good things when it wants to. It seems to want to more and more lately, and I am very pleased. The open source movement is a tremendous breakthrough in cooperative creation and innovation, but the open source repository sites are cluttered with half-baked, abandoned projects, and untested undocumented code. Microsoft open source, which is what Reactive-Extensions is, represents the best of two worlds. </p>

<p>Here is the timer code:</p>

<div class="highlight highlight-Javascript"><pre>    <span class="pl-s">var</span> source1 <span class="pl-k">=</span> Rx.Observable.timer(
        <span class="pl-c1">0</span>,
        <span class="pl-c1">1000</span>)
       .map(<span class="pl-st">function</span> (<span class="pl-vpf">x</span>, <span class="pl-vpf">i</span>) { <span class="pl-k">return</span> (x, <span class="pl-c1">30</span> <span class="pl-k">-</span> i)});

    <span class="pl-s">var</span> source2 <span class="pl-k">=</span> Rx.Observable.timer(
        <span class="pl-c1">0</span>,
        <span class="pl-c1">1000</span>)
       .map(<span class="pl-st">function</span> (<span class="pl-vpf">x</span>, <span class="pl-vpf">i</span>) { <span class="pl-k">return</span> (x, <span class="pl-c1">60</span> <span class="pl-k">-</span> i)});

    sub1 <span class="pl-k">=</span> source1.subscribe(
    <span class="pl-st">function</span> (<span class="pl-vpf">x</span>) {
      <span class="pl-k">if</span> (x <span class="pl-k">&lt;</span> <span class="pl-c1">0</span>) {sub1.dispose();}
    });

    sub2 <span class="pl-k">=</span> source2.subscribe(
    <span class="pl-st">function</span> (<span class="pl-vpf">x</span>) {
      <span class="pl-k">if</span> (x <span class="pl-k">&lt;</span> <span class="pl-c1">0</span>) {sub2.dispose();}
    });

    sub1.dispose();
    sub2.dispose();

    <span class="pl-s">var</span> stop30 <span class="pl-k">=</span> $(<span class="pl-s1"><span class="pl-pds">'</span>#stop30<span class="pl-pds">'</span></span>);
    <span class="pl-s">var</span> stop30Src <span class="pl-k">=</span> Rx.Observable.fromEvent(stop30, <span class="pl-s1"><span class="pl-pds">'</span>click<span class="pl-pds">'</span></span>);
    <span class="pl-s">var</span> stop30Sub <span class="pl-k">=</span> stop30Src.subscribe(<span class="pl-st">function</span> (<span class="pl-vpf">e</span>) {
      <span class="pl-en">console</span><span class="pl-s3">.log</span>(<span class="pl-s1"><span class="pl-pds">"</span>________________Yes!__<span class="pl-pds">"</span></span>);
      sub1.dispose();
      $(<span class="pl-s1"><span class="pl-pds">"</span>#a2<span class="pl-pds">"</span></span>).html(<span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>);
    });

    <span class="pl-s">var</span> stop60 <span class="pl-k">=</span> $(<span class="pl-s1"><span class="pl-pds">'</span>#stop60<span class="pl-pds">'</span></span>);
    <span class="pl-s">var</span> stop60Src <span class="pl-k">=</span> Rx.Observable.fromEvent(stop60, <span class="pl-s1"><span class="pl-pds">'</span>click<span class="pl-pds">'</span></span>);
    <span class="pl-s">var</span> stop60Sub <span class="pl-k">=</span> stop60Src.subscribe(<span class="pl-st">function</span> (<span class="pl-vpf">e</span>) {
      <span class="pl-en">console</span><span class="pl-s3">.log</span>(<span class="pl-s1"><span class="pl-pds">"</span>________________Yes!__<span class="pl-pds">"</span></span>);
      sub2.dispose();
      $(<span class="pl-s1"><span class="pl-pds">"</span>#a2<span class="pl-pds">"</span></span>).html(<span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>);
    });

    <span class="pl-s">var</span> go30 <span class="pl-k">=</span> $(<span class="pl-s1"><span class="pl-pds">'</span>#go30<span class="pl-pds">'</span></span>);
    <span class="pl-s">var</span> go30Src <span class="pl-k">=</span> Rx.Observable.fromEvent(go30, <span class="pl-s1"><span class="pl-pds">'</span>click<span class="pl-pds">'</span></span>);
    <span class="pl-s">var</span> go30Sub <span class="pl-k">=</span> go30Src.subscribe(<span class="pl-st">function</span> (<span class="pl-vpf">e</span>) {
        sub2.dispose();
        sub1.dispose();
        sub1 <span class="pl-k">=</span> source1.subscribe(
        <span class="pl-st">function</span> (<span class="pl-vpf">x</span>) {
          sub2.dispose();
          $(<span class="pl-s1"><span class="pl-pds">"</span>#countdown<span class="pl-pds">"</span></span>).html(x);
          DS_ob.t <span class="pl-k">=</span> x;
          <span class="pl-k">if</span> (x <span class="pl-k">===</span> <span class="pl-c1">0</span>) {
            sub1.dispose();
            $(<span class="pl-s1"><span class="pl-pds">"</span>#countdown<span class="pl-pds">"</span></span>).html(<span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>);
            DS_ob.scoreFunc();
          }
      });
    });

    <span class="pl-s">var</span> go60 <span class="pl-k">=</span> $(<span class="pl-s1"><span class="pl-pds">'</span>#go60<span class="pl-pds">'</span></span>);
    <span class="pl-s">var</span> go60Src <span class="pl-k">=</span> Rx.Observable.fromEvent(go60, <span class="pl-s1"><span class="pl-pds">'</span>click<span class="pl-pds">'</span></span>);
    <span class="pl-s">var</span> go60Sub <span class="pl-k">=</span> go60Src.subscribe(<span class="pl-st">function</span> (<span class="pl-vpf">e</span>) {
        sub2 <span class="pl-k">=</span> source2.subscribe(
        <span class="pl-st">function</span> (<span class="pl-vpf">x</span>) {
          $(<span class="pl-s1"><span class="pl-pds">"</span>#countdown<span class="pl-pds">"</span></span>).html(x);
          DS_ob.t <span class="pl-k">=</span> x;
          <span class="pl-k">if</span> (x <span class="pl-k">===</span> <span class="pl-c1">0</span>) {
            sub2.dispose();
            $(<span class="pl-s1"><span class="pl-pds">"</span>#countdown<span class="pl-pds">"</span></span>).html(<span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>);
            DS_ob.scoreFunc();
        }
      });
    });</pre></div>

<h6>
<a id="it-is-easy-to-start-and-stop-the-timer-for-example-if-a-player-clickes-score-and-uses-up-all-the-dice-without-making-the-number-20-there-is-no-need-to-let-the-30-second-clock-run-down-stop30triggerhandlerclick-shuts-it-down-or-if-a-player-clickes-impossible-starting-a-60-second-countdown-and-another-player-clicks-score-starting-a-30-second-countdown-the-following-code-takes-care-of-the-timers" class="anchor" href="#it-is-easy-to-start-and-stop-the-timer-for-example-if-a-player-clickes-score-and-uses-up-all-the-dice-without-making-the-number-20-there-is-no-need-to-let-the-30-second-clock-run-down-stop30triggerhandlerclick-shuts-it-down-or-if-a-player-clickes-impossible-starting-a-60-second-countdown-and-another-player-clicks-score-starting-a-30-second-countdown-the-following-code-takes-care-of-the-timers" aria-hidden="true"><span class="octicon octicon-link"></span></a>It is easy to start and stop the timer. For example, if a player clickes 'SCORE' and uses up all the dice without making the number '20', there is no need to let the 30-second clock run down. '$("#stop30").triggerHandler('click');' shuts it down. Or, if a player clickes 'IMPOSSIBLE', starting a 60-second countdown, and another player clicks 'SCORE' starting a 30-second countdown, the following code takes care of the timers:</h6>

<div class="highlight highlight-Javascript"><pre>$(<span class="pl-s1"><span class="pl-pds">'</span>#go30<span class="pl-pds">'</span></span>).triggerHandler(<span class="pl-s1"><span class="pl-pds">'</span>click<span class="pl-pds">'</span></span>);

$(<span class="pl-s1"><span class="pl-pds">"</span>#stop0<span class="pl-pds">"</span></span>).triggerHandler(<span class="pl-s1"><span class="pl-pds">'</span>click<span class="pl-pds">'</span></span>);<span class="pl-c1">6</span></pre></div>

<p>There is undoubtedly a more elegant way to trigger the starting and stopping of the clock, but JQuery , triggerHandler, and dummy elements seem so rock solid and reliable in all browsers that I am in no hurry to experiment with less elaborate event listeners.</p>

<p><em>To be continued</em></p>

<h2>
<a id="appendix" class="anchor" href="#appendix" aria-hidden="true"><span class="octicon octicon-link"></span></a>APPENDIX</h2>

<h4>
<a id="impossibles" class="anchor" href="#impossibles" aria-hidden="true"><span class="octicon octicon-link"></span></a>IMPOSSIBLES</h4>

<p>The essence of the Score calculation algorythm in the module Fm is contained in the "impossibles.hs" file. Fm has much formatting code, which is a distraction when evaluating the algorythm.</p>

<p>impossibles.hs computes all dice combinations which cannot be made into the number "20" in two or three stages, as required by the game. In 1.5 seconds, it finds all 104 such combinations using a list comprehension on the seven list comprehensions which cover all possible computations. The five operations are defined as follows:</p>

<div class="highlight highlight-haskell"><pre>{-# <span class="pl-k">LANGUAGE</span> OverloadedStrings #-}

<span class="pl-k">import</span> <span class="pl-s3">Data.List</span>
<span class="pl-k">import</span> <span class="pl-s3">System.CPUTime</span>

<span class="pl-en">notWhole</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Bool</span>
notWhole x = <span class="pl-s3">fromIntegral</span> (<span class="pl-s3">round</span> x) /= x

<span class="pl-en">cat</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span>
cat l m   | m &lt; <span class="pl-c1">0</span>  = <span class="pl-c1">3.1</span>
          | l == <span class="pl-c1">0</span>  = <span class="pl-c1">3.1</span>
          | notWhole l  = <span class="pl-c1">3.1</span>
          | notWhole m  = <span class="pl-c1">3.1</span>
          | <span class="pl-s3">otherwise</span>  = <span class="pl-s3">read</span> (<span class="pl-s3">show</span> (<span class="pl-s3">round</span> l) ++ <span class="pl-s3">show</span> (<span class="pl-s3">round</span> m))

<span class="pl-en">f</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">String</span>
f x = <span class="pl-s3">show</span> (<span class="pl-s3">round</span> x)

<span class="pl-en">scoreDiv</span> <span class="pl-k">::</span> (<span class="pl-st">Eq</span> <span class="pl-vo">a</span>, <span class="pl-st">Fractional</span> <span class="pl-vo">a</span>) <span class="pl-k">=&gt;</span> <span class="pl-vo">a</span> <span class="pl-k">-&gt;</span> <span class="pl-vo">a</span> <span class="pl-k">-&gt;</span> <span class="pl-vo">a</span>
scoreDiv az bz  | bz == <span class="pl-c1">0</span>  = <span class="pl-c1">99999</span>
                | <span class="pl-s3">otherwise</span> = (/) az bz

ops =  [cat, (+), (-), (*), scoreDiv]</pre></div>

<p>The seven algorythms necessary to perform every possible computation are:</p>

<div class="highlight highlight-haskell"><pre><span class="pl-en">calc</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> [(<span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>)]
calc a b c d = [ (a',b',c',d') |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op2 (op1 a' b') c' == <span class="pl-c1">20</span>]

<span class="pl-en">calc2</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> [(<span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>)]
calc2 a b c d = [ (a',b',c',d') |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op2 a' (op1 b' c') == <span class="pl-c1">20</span>]

<span class="pl-en">calc3</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> [(<span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>)]
calc3 a b c d = [ (a',b',c',d') |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op3 &lt;- ops,
                            op3 (op1 a' b') (op2 c' d') == <span class="pl-c1">20</span>]

<span class="pl-en">calc4</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> [(<span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>)]
calc4 a b c d = [ (a',b',c',d')  |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op3 &lt;- ops,
                            op3 (op2 (op1 a' b') c') d' == <span class="pl-c1">20</span>]

calc5 a b c d = [ (a',b',c',d') |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op3 &lt;- ops,
                            op3 (op2 a' (op1 b' c')) d' == <span class="pl-c1">20</span>]

calc6 a b c d = [ (a',b',c',d') |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op3 &lt;- ops,
                            op3 a' (op2 (op1 b' c') d') == <span class="pl-c1">20</span>]

calc7 a b c d = [ (a',b',c',d') |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op3 &lt;- ops,
                            op3 a' (op2 b' (op1 c' d')) == <span class="pl-c1">20</span>]</pre></div>

<p>It is easy to see that there are seven ways to order two or three sequential computations on four numbers. They can be represented by</p>

<div class="highlight highlight-javascript"><pre>a bc
ab c
ab cd
(a bc)d
(ab c)d
a(b cd)
a(bc d)</pre></div>

<p>Those are the combinations used in the seven calc functions. The list comprehension works on all permutations of the order of the four numbers in receives, so c ba is covered by a bc. Next, I wanted to find out if all seven algorythms are necessary to find at least one solution, so I wrote this:</p>

<div class="highlight highlight-haskell"><pre>{-# <span class="pl-k">LANGUAGE</span> OverloadedStrings #-}

<span class="pl-k">import</span> <span class="pl-s3">Data.List</span>
<span class="pl-k">import</span> <span class="pl-s3">System.CPUTime</span>

<span class="pl-en">notWhole</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Bool</span>
notWhole x = <span class="pl-s3">fromIntegral</span> (<span class="pl-s3">round</span> x) /= x

<span class="pl-en">cat</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span>
cat l m   | m &lt; <span class="pl-c1">0</span>  = <span class="pl-c1">3.1</span>
          | l == <span class="pl-c1">0</span>  = <span class="pl-c1">3.1</span>
          | notWhole l  = <span class="pl-c1">3.1</span>
          | notWhole m  = <span class="pl-c1">3.1</span>
          | <span class="pl-s3">otherwise</span>  = <span class="pl-s3">read</span> (<span class="pl-s3">show</span> (<span class="pl-s3">round</span> l) ++ <span class="pl-s3">show</span> (<span class="pl-s3">round</span> m))

<span class="pl-en">f</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">String</span>
f x = <span class="pl-s3">show</span> (<span class="pl-s3">round</span> x)

<span class="pl-en">scoreDiv</span> <span class="pl-k">::</span> (<span class="pl-st">Eq</span> <span class="pl-vo">a</span>, <span class="pl-st">Fractional</span> <span class="pl-vo">a</span>) <span class="pl-k">=&gt;</span> <span class="pl-vo">a</span> <span class="pl-k">-&gt;</span> <span class="pl-vo">a</span> <span class="pl-k">-&gt;</span> <span class="pl-vo">a</span>
scoreDiv az bz  | bz == <span class="pl-c1">0</span>  = <span class="pl-c1">99999</span>
                | <span class="pl-s3">otherwise</span> = (/) az bz

ops =  [cat, (+), (-), (*), scoreDiv]

<span class="pl-en">calc</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> [(<span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>)]
calc a b c d = [ (a',b',c',d') |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op2 (op1 a' b') c' == <span class="pl-c1">20</span>]

<span class="pl-en">calc2</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> [(<span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>)]
calc2 a b c d = [ (a',b',c',d') |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op2 a' (op1 b' c') == <span class="pl-c1">20</span>]

<span class="pl-en">calc3</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> [(<span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>)]
calc3 a b c d = [ (a',b',c',d') |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op3 &lt;- ops,
                            op3 (op1 a' b') (op2 c' d') == <span class="pl-c1">20</span>]

<span class="pl-en">calc4</span> <span class="pl-k">::</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> <span class="pl-s3">Double</span> <span class="pl-k">-&gt;</span> [(<span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>, <span class="pl-s3">Double</span>)]
calc4 a b c d = [ (a',b',c',d')  |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op3 &lt;- ops,
                            op3 (op2 (op1 a' b') c') d' == <span class="pl-c1">20</span>]

calc5 a b c d = [ (a',b',c',d') |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op3 &lt;- ops,
                            op3 (op2 a' (op1 b' c')) d' == <span class="pl-c1">20</span>]

calc6 a b c d = [ (a',b',c',d') |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op3 &lt;- ops,
                            op3 a' (op2 (op1 b' c') d') == <span class="pl-c1">20</span>]

calc7 a b c d = [ (a',b',c',d') |
                        [a',b',c',d<span class="pl-k">']</span> &lt;- nub(permutations [a,b,c,d]),
                            op1 &lt;- ops,
                            op2 &lt;- ops,
                            op3 &lt;- ops,
                            op3 a' (op2 b' (op1 c' d')) == <span class="pl-c1">20</span>]



only_calc = [ [a, b, c, d] | a &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], b &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], c &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">12</span>], d &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">20</span>],
                     a &lt;= b, b &lt;= c, c &lt;= d,
                     <span class="pl-s3">not</span> (<span class="pl-s3">null</span> $ calc a b c d), <span class="pl-s3">null</span> $ calc2 a b c d, <span class="pl-s3">null</span> $ calc3 a b c d,
                     <span class="pl-s3">null</span> $ calc4 a b c d, <span class="pl-s3">null</span> $ calc5 a b c d, <span class="pl-s3">null</span> $ calc6 a b c d,
                     <span class="pl-s3">null</span> $ calc7 a b c d ]


only_calc2 = [ [a, b, c, d] | a &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], b &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], c &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">12</span>], d &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">20</span>],
                     a &lt;= b, b &lt;= c, c &lt;= d,
                     <span class="pl-s3">null</span> $ calc a b c d, <span class="pl-s3">not</span> (<span class="pl-s3">null</span> $ calc2 a b c d), <span class="pl-s3">null</span> $ calc3 a b c d,
                     <span class="pl-s3">null</span> $ calc4 a b c d, <span class="pl-s3">null</span> $ calc5 a b c d, <span class="pl-s3">null</span> $ calc6 a b c d,
                     <span class="pl-s3">null</span> $ calc7 a b c d ]

only_calc3 = [ [a, b, c, d] | a &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], b &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], c &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">12</span>], d &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">20</span>],
                     a &lt;= b, b &lt;= c, c &lt;= d,
                     <span class="pl-s3">null</span> $ calc a b c d, <span class="pl-s3">null</span> $ calc2 a b c d, <span class="pl-s3">not</span> (<span class="pl-s3">null</span> $ calc3 a b c d),
                     <span class="pl-s3">null</span> $ calc4 a b c d, <span class="pl-s3">null</span> $ calc5 a b c d, <span class="pl-s3">null</span> $ calc6 a b c d,
                     <span class="pl-s3">null</span> $ calc7 a b c d ]

only_calc4 = [ [a, b, c, d] | a &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], b &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], c &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">12</span>], d &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">20</span>],
                     a &lt;= b, b &lt;= c, c &lt;= d,
                     <span class="pl-s3">null</span> $ calc a b c d, <span class="pl-s3">null</span> $ calc2 a b c d, <span class="pl-s3">null</span> $ calc3 a b c d,
                     <span class="pl-s3">not</span> (<span class="pl-s3">null</span> $ calc4 a b c d), <span class="pl-s3">null</span> $ calc5 a b c d, <span class="pl-s3">null</span> $ calc6 a b c d,
                     <span class="pl-s3">null</span> $ calc7 a b c d ]

only_calc5 = [ [a, b, c, d] | a &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], b &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], c &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">12</span>], d &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">20</span>],
                     a &lt;= b, b &lt;= c, c &lt;= d,
                     <span class="pl-s3">null</span> $ calc a b c d, <span class="pl-s3">null</span> $ calc2 a b c d, <span class="pl-s3">null</span> $ calc3 a b c d,
                     <span class="pl-s3">null</span> $ calc4 a b c d, <span class="pl-s3">not</span> (<span class="pl-s3">null</span> $ calc5 a b c d), <span class="pl-s3">null</span> $ calc6 a b c d,
                     <span class="pl-s3">null</span> $ calc7 a b c d ]

only_calc6 = [ [a, b, c, d] | a &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], b &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], c &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">12</span>], d &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">20</span>],
                     a &lt;= b, b &lt;= c, c &lt;= d,
                     <span class="pl-s3">null</span> $ calc a b c d, <span class="pl-s3">null</span> $ calc2 a b c d, <span class="pl-s3">null</span> $ calc3 a b c d,
                     <span class="pl-s3">null</span> $ calc4 a b c d, <span class="pl-s3">null</span> $ calc5 a b c d, <span class="pl-s3">not</span> (<span class="pl-s3">null</span> $ calc6 a b c d),
                     <span class="pl-s3">null</span> $ calc7 a b c d ]

only_calc7 = [ [a, b, c, d] | a &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], b &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], c &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">12</span>], d &lt;- [<span class="pl-c1">1</span>..<span class="pl-c1">20</span>],
                     a &lt;= b, b &lt;= c, c &lt;= d,
                     <span class="pl-s3">null</span> $ calc a b c d, <span class="pl-s3">null</span> $ calc2 a b c d, <span class="pl-s3">null</span> $ calc3 a b c d,
                     <span class="pl-s3">null</span> $ calc4 a b c d, <span class="pl-s3">null</span> $ calc5 a b c d, <span class="pl-s3">null</span> $ calc6 a b c d,
                     <span class="pl-s3">not</span> (<span class="pl-s3">null</span> $ calc7 a b c d <span class="pl-k">)]</span>

main = <span class="pl-k">do</span>
    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc<span class="pl-pds">"</span></span>
    t1 &lt;- getCPUTime
    <span class="pl-s3">mapM_</span> <span class="pl-s3">print</span> only_calc
    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>

    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc2<span class="pl-pds">"</span></span>
    <span class="pl-s3">mapM_</span> <span class="pl-s3">print</span> only_calc2
    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>

    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc3<span class="pl-pds">"</span></span>
    <span class="pl-s3">mapM_</span> <span class="pl-s3">print</span> only_calc3
    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>

    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc4<span class="pl-pds">"</span></span>
    <span class="pl-s3">mapM_</span> <span class="pl-s3">print</span> only_calc4
    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>

    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc5<span class="pl-pds">"</span></span>
    <span class="pl-s3">mapM_</span> <span class="pl-s3">print</span> only_calc5
    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>

    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc6<span class="pl-pds">"</span></span>
    <span class="pl-s3">mapM_</span> <span class="pl-s3">print</span> only_calc6
    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>

    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc7<span class="pl-pds">"</span></span>
    <span class="pl-s3">mapM_</span> <span class="pl-s3">print</span> only_calc7
    t2 &lt;- getCPUTime
    <span class="pl-k">let</span> t = <span class="pl-s3">fromIntegral</span> (t2-t1) * <span class="pl-c1">1e-12</span>
    <span class="pl-s3">print</span> t
    <span class="pl-s3">print</span> <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span></pre></div>

<p>Here is what I got:</p>

<div class="highlight highlight-javascript"><pre>e@e<span class="pl-k">:~</span>/b0$ ./analysis_A
<span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc<span class="pl-pds">"</span></span>
[<span class="pl-c1">1.0</span>,<span class="pl-c1">3.0</span>,<span class="pl-c1">11.0</span>,<span class="pl-c1">15.0</span>]
[<span class="pl-c1">1.0</span>,<span class="pl-c1">3.0</span>,<span class="pl-c1">11.0</span>,<span class="pl-c1">19.0</span>]
[<span class="pl-c1">1.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">9.0</span>,<span class="pl-c1">20.0</span>]
[<span class="pl-c1">1.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">10.0</span>,<span class="pl-c1">20.0</span>]
[<span class="pl-c1">1.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">11.0</span>,<span class="pl-c1">20.0</span>]
[<span class="pl-c1">2.0</span>,<span class="pl-c1">2.0</span>,<span class="pl-c1">11.0</span>,<span class="pl-c1">15.0</span>]
[<span class="pl-c1">2.0</span>,<span class="pl-c1">2.0</span>,<span class="pl-c1">11.0</span>,<span class="pl-c1">17.0</span>]
[<span class="pl-c1">3.0</span>,<span class="pl-c1">3.0</span>,<span class="pl-c1">3.0</span>,<span class="pl-c1">13.0</span>]
[<span class="pl-c1">3.0</span>,<span class="pl-c1">3.0</span>,<span class="pl-c1">7.0</span>,<span class="pl-c1">17.0</span>]
[<span class="pl-c1">3.0</span>,<span class="pl-c1">4.0</span>,<span class="pl-c1">9.0</span>,<span class="pl-c1">16.0</span>]
[<span class="pl-c1">3.0</span>,<span class="pl-c1">4.0</span>,<span class="pl-c1">11.0</span>,<span class="pl-c1">14.0</span>]
[<span class="pl-c1">4.0</span>,<span class="pl-c1">4.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">17.0</span>]
[<span class="pl-c1">5.0</span>,<span class="pl-c1">5.0</span>,<span class="pl-c1">5.0</span>,<span class="pl-c1">11.0</span>]
[<span class="pl-c1">5.0</span>,<span class="pl-c1">5.0</span>,<span class="pl-c1">5.0</span>,<span class="pl-c1">13.0</span>]
[<span class="pl-c1">5.0</span>,<span class="pl-c1">5.0</span>,<span class="pl-c1">5.0</span>,<span class="pl-c1">17.0</span>]
<span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc2<span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc3<span class="pl-pds">"</span></span>
[<span class="pl-c1">1.0</span>,<span class="pl-c1">1.0</span>,<span class="pl-c1">1.0</span>,<span class="pl-c1">11.0</span>]
[<span class="pl-c1">1.0</span>,<span class="pl-c1">1.0</span>,<span class="pl-c1">7.0</span>,<span class="pl-c1">17.0</span>]
[<span class="pl-c1">1.0</span>,<span class="pl-c1">1.0</span>,<span class="pl-c1">12.0</span>,<span class="pl-c1">12.0</span>]
[<span class="pl-c1">1.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">6.0</span>]
[<span class="pl-c1">1.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">9.0</span>,<span class="pl-c1">9.0</span>]
[<span class="pl-c1">3.0</span>,<span class="pl-c1">3.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">6.0</span>]
[<span class="pl-c1">3.0</span>,<span class="pl-c1">4.0</span>,<span class="pl-c1">7.0</span>,<span class="pl-c1">18.0</span>]
[<span class="pl-c1">3.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">7.0</span>,<span class="pl-c1">14.0</span>]
[<span class="pl-c1">5.0</span>,<span class="pl-c1">5.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">17.0</span>]
[<span class="pl-c1">5.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">6.0</span>]
<span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc4<span class="pl-pds">"</span></span>
[<span class="pl-c1">1.0</span>,<span class="pl-c1">1.0</span>,<span class="pl-c1">4.0</span>,<span class="pl-c1">11.0</span>]
[<span class="pl-c1">1.0</span>,<span class="pl-c1">4.0</span>,<span class="pl-c1">9.0</span>,<span class="pl-c1">9.0</span>]
[<span class="pl-c1">1.0</span>,<span class="pl-c1">4.0</span>,<span class="pl-c1">9.0</span>,<span class="pl-c1">19.0</span>]
[<span class="pl-c1">1.0</span>,<span class="pl-c1">5.0</span>,<span class="pl-c1">11.0</span>,<span class="pl-c1">11.0</span>]
[<span class="pl-c1">1.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">12.0</span>]
[<span class="pl-c1">1.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">11.0</span>,<span class="pl-c1">11.0</span>]
[<span class="pl-c1">3.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">9.0</span>,<span class="pl-c1">12.0</span>]
[<span class="pl-c1">6.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">7.0</span>,<span class="pl-c1">18.0</span>]
[<span class="pl-c1">6.0</span>,<span class="pl-c1">6.0</span>,<span class="pl-c1">9.0</span>,<span class="pl-c1">14.0</span>]
<span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc5<span class="pl-pds">"</span></span>
[<span class="pl-c1">1.0</span>,<span class="pl-c1">3.0</span>,<span class="pl-c1">8.0</span>,<span class="pl-c1">20.0</span>]
[<span class="pl-c1">3.0</span>,<span class="pl-c1">3.0</span>,<span class="pl-c1">10.0</span>,<span class="pl-c1">17.0</span>]
[<span class="pl-c1">3.0</span>,<span class="pl-c1">4.0</span>,<span class="pl-c1">10.0</span>,<span class="pl-c1">16.0</span>]
<span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc6<span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc7<span class="pl-pds">"</span></span>
<span class="pl-c1">8.27113</span>
<span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span></pre></div>

<h6>
<a id="this-shows-that-there-is-no-solution-that-only-calc2-only-calc6-or-only-calc7-can-find-next-i-checkes-all-combinations-of-these-three" class="anchor" href="#this-shows-that-there-is-no-solution-that-only-calc2-only-calc6-or-only-calc7-can-find-next-i-checkes-all-combinations-of-these-three" aria-hidden="true"><span class="octicon octicon-link"></span></a>This shows that there is no solution that only calc2, only calc6, or only calc7 can find. Next, I checkes all combinations of these three:</h6>

<div class="highlight highlight-javascript"><pre>{<span class="pl-k">-</span># LANGUAGE OverloadedStrings #<span class="pl-k">-</span>}

<span class="pl-k">import</span> Data.List
<span class="pl-k">import</span> System.CPUTime

notWhole <span class="pl-k">::</span> Double <span class="pl-k">-&gt;</span> Bool
notWhole x <span class="pl-k">=</span> fromIntegral (round x) <span class="pl-k">/=</span> x

cat <span class="pl-k">::</span> Double <span class="pl-k">-&gt;</span> Double <span class="pl-k">-&gt;</span> Double
cat l m   | m <span class="pl-k">&lt;</span> <span class="pl-c1">0</span>  <span class="pl-k">=</span> <span class="pl-c1">3.1</span>
          | l <span class="pl-k">==</span> <span class="pl-c1">0</span>  <span class="pl-k">=</span> <span class="pl-c1">3.1</span>
          | notWhole l  <span class="pl-k">=</span> <span class="pl-c1">3.1</span>
          | notWhole m  <span class="pl-k">=</span> <span class="pl-c1">3.1</span>
          | otherwise  <span class="pl-k">=</span> read (show (round l) <span class="pl-k">++</span> show (round m))

f <span class="pl-k">::</span> Double <span class="pl-k">-&gt;</span> <span class="pl-s3">String</span>
f x <span class="pl-k">=</span> show (round x)

scoreDiv <span class="pl-k">::</span> (Eq a, Fractional a) <span class="pl-k">=&gt;</span> a <span class="pl-k">-&gt;</span> a <span class="pl-k">-&gt;</span> a
scoreDiv az bz  | bz <span class="pl-k">==</span> <span class="pl-c1">0</span>  <span class="pl-k">=</span> <span class="pl-c1">99999</span>
                | otherwise <span class="pl-k">=</span> (/) az bz

ops <span class="pl-k">=</span>  [cat, (<span class="pl-k">+</span>), (<span class="pl-k">-</span>), (<span class="pl-k">*</span>), scoreDiv]

calc <span class="pl-k">::</span> Double <span class="pl-k">-&gt;</span> Double <span class="pl-k">-&gt;</span> Double <span class="pl-k">-&gt;</span> Double <span class="pl-k">-&gt;</span> [(Double, Double, Double, Double)]
calc a b c d <span class="pl-k">=</span> [ (a<span class="pl-s1"><span class="pl-pds">'</span>,b<span class="pl-pds">'</span></span>,c<span class="pl-s1"><span class="pl-pds">'</span>,d<span class="pl-pds">'</span></span>) |
                        [a<span class="pl-s1"><span class="pl-pds">'</span>,b<span class="pl-pds">'</span></span>,c<span class="pl-s1"><span class="pl-pds">'</span>,d<span class="pl-pds">'</span></span>] <span class="pl-k">&lt;-</span> nub(permutations [a,b,c,d]),
                            op1 <span class="pl-k">&lt;-</span> ops,
                            op2 <span class="pl-k">&lt;-</span> ops,
                            op2 (op1 a<span class="pl-s1"><span class="pl-pds">'</span> b<span class="pl-pds">'</span></span>) c<span class="pl-s1"><span class="pl-pds">'</span> == 20]</span>
<span class="pl-s1"></span>
<span class="pl-s1">calc2 :: Double -&gt; Double -&gt; Double -&gt; Double -&gt; [(Double, Double, Double, Double)]</span>
<span class="pl-s1">calc2 a b c d = [ (a<span class="pl-pds">'</span></span>,b<span class="pl-s1"><span class="pl-pds">'</span>,c<span class="pl-pds">'</span></span>,d<span class="pl-s1"><span class="pl-pds">'</span>) |</span>
<span class="pl-s1">                        [a<span class="pl-pds">'</span></span>,b<span class="pl-s1"><span class="pl-pds">'</span>,c<span class="pl-pds">'</span></span>,d<span class="pl-s1"><span class="pl-pds">'</span>] &lt;- nub(permutations [a,b,c,d]),</span>
<span class="pl-s1">                            op1 &lt;- ops,</span>
<span class="pl-s1">                            op2 &lt;- ops,</span>
<span class="pl-s1">                            op2 a<span class="pl-pds">'</span></span> (op1 b<span class="pl-s1"><span class="pl-pds">'</span> c<span class="pl-pds">'</span></span>) <span class="pl-k">==</span> <span class="pl-c1">20</span>]

calc3 <span class="pl-k">::</span> Double <span class="pl-k">-&gt;</span> Double <span class="pl-k">-&gt;</span> Double <span class="pl-k">-&gt;</span> Double <span class="pl-k">-&gt;</span> [(Double, Double, Double, Double)]
calc3 a b c d <span class="pl-k">=</span> [ (a<span class="pl-s1"><span class="pl-pds">'</span>,b<span class="pl-pds">'</span></span>,c<span class="pl-s1"><span class="pl-pds">'</span>,d<span class="pl-pds">'</span></span>) |
                        [a<span class="pl-s1"><span class="pl-pds">'</span>,b<span class="pl-pds">'</span></span>,c<span class="pl-s1"><span class="pl-pds">'</span>,d<span class="pl-pds">'</span></span>] <span class="pl-k">&lt;-</span> nub(permutations [a,b,c,d]),
                            op1 <span class="pl-k">&lt;-</span> ops,
                            op2 <span class="pl-k">&lt;-</span> ops,
                            op3 <span class="pl-k">&lt;-</span> ops,
                            op3 (op1 a<span class="pl-s1"><span class="pl-pds">'</span> b<span class="pl-pds">'</span></span>) (op2 c<span class="pl-s1"><span class="pl-pds">'</span> d<span class="pl-pds">'</span></span>) <span class="pl-k">==</span> <span class="pl-c1">20</span>]

calc4 <span class="pl-k">::</span> Double <span class="pl-k">-&gt;</span> Double <span class="pl-k">-&gt;</span> Double <span class="pl-k">-&gt;</span> Double <span class="pl-k">-&gt;</span> [(Double, Double, Double, Double)]
calc4 a b c d <span class="pl-k">=</span> [ (a<span class="pl-s1"><span class="pl-pds">'</span>,b<span class="pl-pds">'</span></span>,c<span class="pl-s1"><span class="pl-pds">'</span>,d<span class="pl-pds">'</span></span>)  |
                        [a<span class="pl-s1"><span class="pl-pds">'</span>,b<span class="pl-pds">'</span></span>,c<span class="pl-s1"><span class="pl-pds">'</span>,d<span class="pl-pds">'</span></span>] <span class="pl-k">&lt;-</span> nub(permutations [a,b,c,d]),
                            op1 <span class="pl-k">&lt;-</span> ops,
                            op2 <span class="pl-k">&lt;-</span> ops,
                            op3 <span class="pl-k">&lt;-</span> ops,
                            op3 (op2 (op1 a<span class="pl-s1"><span class="pl-pds">'</span> b<span class="pl-pds">'</span></span>) c<span class="pl-s1"><span class="pl-pds">'</span>) d<span class="pl-pds">'</span></span> <span class="pl-k">==</span> <span class="pl-c1">20</span>]

calc5 a b c d <span class="pl-k">=</span> [ (a<span class="pl-s1"><span class="pl-pds">'</span>,b<span class="pl-pds">'</span></span>,c<span class="pl-s1"><span class="pl-pds">'</span>,d<span class="pl-pds">'</span></span>) |
                        [a<span class="pl-s1"><span class="pl-pds">'</span>,b<span class="pl-pds">'</span></span>,c<span class="pl-s1"><span class="pl-pds">'</span>,d<span class="pl-pds">'</span></span>] <span class="pl-k">&lt;-</span> nub(permutations [a,b,c,d]),
                            op1 <span class="pl-k">&lt;-</span> ops,
                            op2 <span class="pl-k">&lt;-</span> ops,
                            op3 <span class="pl-k">&lt;-</span> ops,
                            op3 (op2 a<span class="pl-s1"><span class="pl-pds">'</span> (op1 b<span class="pl-pds">'</span></span> c<span class="pl-s1"><span class="pl-pds">'</span>)) d<span class="pl-pds">'</span></span> <span class="pl-k">==</span> <span class="pl-c1">20</span>]

calc6 a b c d <span class="pl-k">=</span> [ (a<span class="pl-s1"><span class="pl-pds">'</span>,b<span class="pl-pds">'</span></span>,c<span class="pl-s1"><span class="pl-pds">'</span>,d<span class="pl-pds">'</span></span>) |
                        [a<span class="pl-s1"><span class="pl-pds">'</span>,b<span class="pl-pds">'</span></span>,c<span class="pl-s1"><span class="pl-pds">'</span>,d<span class="pl-pds">'</span></span>] <span class="pl-k">&lt;-</span> nub(permutations [a,b,c,d]),
                            op1 <span class="pl-k">&lt;-</span> ops,
                            op2 <span class="pl-k">&lt;-</span> ops,
                            op3 <span class="pl-k">&lt;-</span> ops,
                            op3 a<span class="pl-s1"><span class="pl-pds">'</span> (op2 (op1 b<span class="pl-pds">'</span></span> c<span class="pl-s1"><span class="pl-pds">'</span>) d<span class="pl-pds">'</span></span>) <span class="pl-k">==</span> <span class="pl-c1">20</span>]

calc7 a b c d <span class="pl-k">=</span> [ (a<span class="pl-s1"><span class="pl-pds">'</span>,b<span class="pl-pds">'</span></span>,c<span class="pl-s1"><span class="pl-pds">'</span>,d<span class="pl-pds">'</span></span>) |
                        [a<span class="pl-s1"><span class="pl-pds">'</span>,b<span class="pl-pds">'</span></span>,c<span class="pl-s1"><span class="pl-pds">'</span>,d<span class="pl-pds">'</span></span>] <span class="pl-k">&lt;-</span> nub(permutations [a,b,c,d]),
                            op1 <span class="pl-k">&lt;-</span> ops,
                            op2 <span class="pl-k">&lt;-</span> ops,
                            op3 <span class="pl-k">&lt;-</span> ops,
                            op3 a<span class="pl-s1"><span class="pl-pds">'</span> (op2 b<span class="pl-pds">'</span></span> (op1 c<span class="pl-s1"><span class="pl-pds">'</span> d<span class="pl-pds">'</span></span>)) <span class="pl-k">==</span> <span class="pl-c1">20</span>]


only_calc2_or_6 <span class="pl-k">=</span> [ [a, b, c, d] | a <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], b <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], c <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">12</span>], d <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">20</span>],
                     a <span class="pl-k">&lt;=</span> b, b <span class="pl-k">&lt;=</span> c, c <span class="pl-k">&lt;=</span> d,
                     <span class="pl-c1">null</span> $ calc a b c d, not (<span class="pl-c1">null</span> $ calc2 a b c d), <span class="pl-c1">null</span> $ calc3 a b c d,
                     <span class="pl-c1">null</span> $ calc4 a b c d, <span class="pl-c1">null</span> $ calc5 a b c d, not (<span class="pl-c1">null</span> $ calc6 a b c d),
                     <span class="pl-c1">null</span> $ calc7 a b c d ]

only_calc2_or_7 <span class="pl-k">=</span> [ [a, b, c, d] | a <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], b <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], c <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">12</span>], d <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">20</span>],
                     a <span class="pl-k">&lt;=</span> b, b <span class="pl-k">&lt;=</span> c, c <span class="pl-k">&lt;=</span> d,
                     <span class="pl-c1">null</span> $ calc a b c d, not (<span class="pl-c1">null</span> $ calc2 a b c d), <span class="pl-c1">null</span> $ calc3 a b c d,
                     <span class="pl-c1">null</span> $ calc4 a b c d, <span class="pl-c1">null</span> $ calc5 a b c d, <span class="pl-c1">null</span> $ calc6 a b c d,
                     not (<span class="pl-c1">null</span> $ calc7 a b c d) ]

only_calc6_or_7 <span class="pl-k">=</span> [ [a, b, c, d] | a <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], b <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], c <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">12</span>], d <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">20</span>],
                     a <span class="pl-k">&lt;=</span> b, b <span class="pl-k">&lt;=</span> c, c <span class="pl-k">&lt;=</span> d,
                     <span class="pl-c1">null</span> $ calc a b c d, <span class="pl-c1">null</span> $ calc2 a b c d, <span class="pl-c1">null</span> $ calc3 a b c d,
                     <span class="pl-c1">null</span> $ calc4 a b c d, <span class="pl-c1">null</span> $ calc5 a b c d, not (<span class="pl-c1">null</span> $ calc6 a b c d),
                     not (<span class="pl-c1">null</span> $ calc7 a b c d )]


only_calc2_or_6_or_7 <span class="pl-k">=</span> [ [a, b, c, d] | a <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], b <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">6</span>], c <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">12</span>], d <span class="pl-k">&lt;-</span> [<span class="pl-c1">1</span>..<span class="pl-c1">20</span>],
                     a <span class="pl-k">&lt;=</span> b, b <span class="pl-k">&lt;=</span> c, c <span class="pl-k">&lt;=</span> d,
                     <span class="pl-c1">null</span> $ calc a b c d, not (<span class="pl-c1">null</span> $ calc2 a b c d), <span class="pl-c1">null</span> $ calc3 a b c d,
                     <span class="pl-c1">null</span> $ calc4 a b c d, <span class="pl-c1">null</span> $ calc5 a b c d, not (<span class="pl-c1">null</span> $ calc6 a b c d),
                     not (<span class="pl-c1">null</span> $ calc7 a b c d )]

main <span class="pl-k">=</span> <span class="pl-k">do</span>
    print <span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc2_or_6<span class="pl-pds">"</span></span>
    t1 <span class="pl-k">&lt;-</span> getCPUTime
    mapM_ print only_calc2_or_6
    print <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>

    print <span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc2_or_7<span class="pl-pds">"</span></span>
    mapM_ print only_calc2_or_7
    print <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>

    print <span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc6_or_7<span class="pl-pds">"</span></span>
    mapM_ print only_calc6_or_7
    print <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>

    print <span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc2_or_6_or_7<span class="pl-pds">"</span></span>
    mapM_ print only_calc2_or_6_or_7
    t2 <span class="pl-k">&lt;-</span> getCPUTime
    <span class="pl-s">let</span> t <span class="pl-k">=</span> fromIntegral (t2<span class="pl-k">-</span>t1) <span class="pl-k">*</span> <span class="pl-c1">1e-12</span>
    print t
</pre></div>

<p>And here is what I got:</p>

<div class="highlight highlight-javascript"><pre>    e@e<span class="pl-k">:~</span>/b0$ ./analysis_B
<span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc2_or_6<span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc2_or_7<span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc6_or_7<span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>
<span class="pl-s1"><span class="pl-pds">"</span>*****************************___only_calc2_or_6_or_7<span class="pl-pds">"</span></span>
[<span class="pl-c1">2.0</span>,<span class="pl-c1">5.0</span>,<span class="pl-c1">12.0</span>,<span class="pl-c1">12.0</span>]
<span class="pl-c1">3.385727</span></pre></div>

<h6>
<a id="there-are-no-rolls-of-the-dice-that-can-be-found-only-by-some-pair-of-these-functions-and-251212-is-the-only-roll-that-can-be-found-by-all-three-but-none-of-the-algorythms-calc-calc3-calc4-and-calc5-which-uniquely-solve-some-rolls-those-four-along-with-any-one-of-calc2-calc6-or-calc7-are-sufficient-to-find-at-least-one-solution-if-a-roll-is-solvable-a-corrolary-is-that-if-calc-calc2-calc3-calc4-and-calc5-cant-find-a-solution-calc6-and-calc7-wont-either-i-tested-this-by-removing-calc6-and-calc7-from-impossibleshs-and-renaming-it-impossibles2hs-like-impossibleshs-it-found-the-104-impossible-rolls-only-in-133-instead-of-150-seconds" class="anchor" href="#there-are-no-rolls-of-the-dice-that-can-be-found-only-by-some-pair-of-these-functions-and-251212-is-the-only-roll-that-can-be-found-by-all-three-but-none-of-the-algorythms-calc-calc3-calc4-and-calc5-which-uniquely-solve-some-rolls-those-four-along-with-any-one-of-calc2-calc6-or-calc7-are-sufficient-to-find-at-least-one-solution-if-a-roll-is-solvable-a-corrolary-is-that-if-calc-calc2-calc3-calc4-and-calc5-cant-find-a-solution-calc6-and-calc7-wont-either-i-tested-this-by-removing-calc6-and-calc7-from-impossibleshs-and-renaming-it-impossibles2hs-like-impossibleshs-it-found-the-104-impossible-rolls-only-in-133-instead-of-150-seconds" aria-hidden="true"><span class="octicon octicon-link"></span></a>There are no rolls of the dice that can be found only by some pair of these functions, and (2,5,12,12) is the only roll that can be found by all three, but none of the algorythms (calc, calc3, calc4, and calc5) which uniquely solve some rolls. Those four along with any one of calc2, calc6, or calc7, are sufficient to find at least one solution if a roll is solvable. A corrolary is that if calc, calc2, calc3, calc4, and calc5 can't find a solution, calc6 and calc7 won't either. I tested this by removing calc6 and calc7 from impossibles.hs and renaming it impossibles2.hs. Like impossibles.hs, it found the 104 impossible rolls, only in 1.33 instead of 1.50 seconds.</h6>

<p>The module Fm uses the seven algorythms to find solutions to random rolls or numbers entered by Score players. It massages the output into a single line of Text with solutions separated by "br" in &lt;&gt; brackets. The browsers receive the Text as a Javascript string which, when appended to a div, displays the solutions neatly in a column.</p>
      </section>
    </div>

    
  </body>
</html>